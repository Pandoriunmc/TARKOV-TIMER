<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">TARKOV TIMER by Pandoriun</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&display=swap" rel="stylesheet">
    
    <link rel="apple-touch-icon" href="https://i.imgur.com/FyKytkJ.png"> 
    <meta name="apple-mobile-web-app-capable" content="yes"> 
    <meta name="theme-color" content="#1a1a1a"> 
    <meta name="apple-mobile-web-app-title" content="Tarkov Timer">

    <style>
        /* Estilos Base (mantidos) */
        body {
            font-family: 'Consolas', monospace, sans-serif;
            background-color: #1a1a1a;
            background-image: url('https://i.imgur.com/FyKytkJ.png'); 
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #ddd;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
        }

        .container {
            /* Fundo semitransparente fixo para o container */
            background-color: rgba(30, 30, 30, 0.95); /* Cor padrão inicial */
            border: 3px solid #f7a61d;
            border-radius: 10px;
            padding: 25px 20px; 
            box-shadow: 0 0 25px rgba(247, 166, 29, 0.4);
            text-align: center;
            width: 90%;
            max-width: 900px;
            position: relative;
            overflow: hidden;
            transition: background-color 1.5s ease; /* Transição suave para a cor de fundo */
        }
        
        .language-selector {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 20;
        }

        .language-selector select {
            background-color: #2e2e2e;
            color: #f7a61d;
            border: 1px solid #f7a61d;
            padding: 5px 8px;
            border-radius: 5px;
            font-size: 0.9em;
            cursor: pointer;
            outline: none;
            appearance: none;
        }
        
        /* TÍTULO TEMÁTICO (mantidos) */
        .label-main {
            font-family: 'Orbitron', sans-serif; 
            font-size: 1.8em; 
            font-weight: 700;
            color: #f7a61d; 
            margin-bottom: 5px; 
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 8px rgba(247, 166, 29, 0.6);
        }

        /* --- ALERTA DE CULTISTAS (mantidos) --- */
        #cultist-alert-wrapper {
            height: 3.5em; 
            margin-bottom: 0px; 
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, visibility 0.5s;
        }

        #cultist-alert {
            font-family: Arial, sans-serif;
            font-size: 0.9em;
            font-weight: bold;
            animation: blink 4s infinite; 
            text-shadow: none;
        }
        
        @keyframes blink {
            0% { color: red; text-shadow: 0 0 5px rgba(255, 0, 0, 0.8); }
            33% { color: black; text-shadow: none; }
            66% { color: white; text-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
            100% { color: red; text-shadow: 0 0 5px rgba(255, 0, 0, 0.8); }
        }

        #cultist-alert-countdown {
            display: block;
            font-size: 0.8em;
            font-weight: normal;
            margin-top: 3px;
            color: #ccc;
            text-shadow: none;
        }

        #cultist-alert-countdown .server-highlight {
            font-weight: bold;
            font-size: 1.1em; 
            color: #fff; 
            margin-left: 5px;
        }

        #cultist-alert-wrapper.active {
            visibility: visible;
            opacity: 1;
        }
        /* --- FIM DO ALERTA --- */

        /* Canvas para Estrelas (mantidos) */
        #stars-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 2s ease-in-out;
            z-index: 1;
            pointer-events: none;
            mask-image: radial-gradient(circle at center, black 0%, black 50%, transparent 80%);
            -webkit-mask-image: radial-gradient(circle at center, black 0%, black 50%, transparent 80%);
        }
        
        .content-wrapper { position: relative; z-index: 10; }
        .clocks-display { display: flex; justify-content: center; gap: 30px; margin: 15px 0; }
        .clock-item { flex-basis: 45%; text-align: center; }
        .clock-value { font-size: 5.0em; font-weight: bold; letter-spacing: 3px; margin-bottom: 5px; transition: color 0.5s, text-shadow 0.5s; }
        .clock-label { font-size: 1.1em; color: #ccc; margin-bottom: 10px; text-transform: uppercase; }
        .status-category { 
            font-size: 1.3em; 
            font-weight: bold; 
            margin-top: -10px; 
            margin-bottom: 20px; 
            transition: color 0.5s; 
        }

        .controls { margin-top: 15px; padding-top: 15px; border-top: 1.5px dashed #555; }
        .controls h2 { margin-top: 0; }
        .controls label, .controls input, .controls button { display: block; margin: 8px auto; font-size: 1em; }
        
        .sync-buttons-wrapper {
            display: flex;
            flex-direction: column; /* Para empilhar os botões */
            align-items: center;
            gap: 10px; /* Espaço entre os botões */
            margin-bottom: 15px;
        }
        
        .controls input[type="time"] { 
            background-color: #2e2e2e; 
            color: #fff; 
            border: 1px solid #777; 
            padding: 8px; 
            border-radius: 5px; 
            width: 150px; 
            text-align: center; 
            font-size: 1.1em; 
            display: block; 
        }
        .controls label[for="initial-time"] {
            display: block; 
        }
        
        .controls button { 
            background-color: #723a00; 
            color: white; 
            padding: 10px 20px; 
            border: 1px solid #f7a61d; 
            border-radius: 5px; 
            cursor: pointer; 
            transition: background-color 0.3s, border-color 0.3s; 
            text-transform: uppercase; 
            font-weight: bold; 
            margin-bottom: 0px; /* Removido o margin-bottom para usar o gap do wrapper */
        }
        .controls button:hover { background-color: #944e00; border-color: #fff; }

        /* NOVO ESTILO: Botão de Sincronização Online (Azul) */
        #sync-online-button {
            background-color: #1e88e5; /* Azul mais escuro */
            border-color: #64b5f6; /* Azul mais claro para a borda */
        }
        #sync-online-button:hover {
            background-color: #42a5f5; /* Azul um pouco mais claro no hover */
            border-color: white;
        }

        
        /* Estilos dos Links (mantidos) */
        .submenu-title {
            font-size: 1.1em; 
            color: #f7a61d;
            margin-bottom: 8px; 
            text-transform: uppercase;
        }
        
        .fast-links {
            margin-top: 15px;
            border-top: 1.5px dashed #555; 
            padding-top: 10px; 
            font-size: 0.85em; 
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px; 
        }
        
        .fast-links a {
            color: #f7a61d;
            text-decoration: none;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 1px;
            padding: 4px 8px; 
            border: 1px solid #f7a61d;
            border-radius: 3px;
            transition: background-color 0.3s, color 0.3s;
            display: flex; 
            align-items: center;
            line-height: 1; 
        }
        .fast-links a:hover {
            background-color: #f7a61d;
            color: #1a1a1a;
        }

        .mapgenie-link {
            padding: 2px 8px !important; 
        }
        .mapgenie-link img {
            height: 18px; 
            vertical-align: middle;
        }

        .submenu-container {
            margin-top: 15px; 
            padding-top: 10px; 
            border-top: 1px dashed #555;
        }
        
        .submenu-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px; 
        }
        .submenu-list a {
            color: #ddd;
            text-decoration: none;
            font-size: 0.8em; 
            padding: 4px 8px; 
            border: 1px solid #555;
            border-radius: 3px;
            transition: background-color 0.3s;
        }
        .submenu-list a:hover {
            background-color: #333;
            color: white;
        }

        .footer { margin-top: 15px; font-size: 0.8em; color: #ddd; text-shadow: 1px 1px 1px #000; }
        .footer a { color: inherit; text-decoration: none; border-bottom: 1px dotted #fff; }
        .footer a:hover { border-bottom-style: solid; }
        .gemini-logo { display: inline-block; width: 12px; height: 12px; margin-left: 5px; vertical-align: middle; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="rgb(255,255,255)" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-4H8V5h6.05L16 7.95V14h-3v5z"/></svg>'); background-size: cover; }
        
        @media (max-width: 650px) {
            .container { padding: 20px 10px; }
            .clocks-display { flex-direction: column; gap: 15px; }
            .clock-value { font-size: 3.5em; }
            #cultist-alert-wrapper { height: 3em; }
            .fast-links a, .submenu-list a { font-size: 0.7em; padding: 3px 6px; }
            .mapgenie-link img { height: 16px; }
            .sync-buttons-wrapper { flex-direction: column; gap: 8px; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="language-selector">
        <select id="language-select" onchange="setLanguage(this.value)">
            <option value="pt">Português (BR)</option>
            <option value="en">English (US)</option>
        </select>
    </div>
    
    <canvas id="stars-canvas"></canvas>

    <div class="content-wrapper">
        <div id="main-label" class="label-main">TARKOV TIMER by Pandoriun</div>
        
        <div id="cultist-alert-wrapper">
            <div id="cultist-alert">RISCO DE CULTISTAS</div>
            <span id="cultist-alert-countdown"></span>
        </div>
        
        <div class="clocks-display">
            <div class="clock-item">
                <div id="tarkov-clock-1" class="clock-value">13:00:00</div>
                <div id="status-1" class="status-category">TARDE</div>
                <div id="server-label-1" class="clock-label">Servidor 1</div>
            </div>
            <div class="clock-item">
                <div id="tarkov-clock-2" class="clock-value">01:00:00</div>
                <div id="status-2" class="status-category">MADRUGADA</div>
                <div id="server-label-2" class="clock-label">Servidor 2 (+12h)</div>
            </div>
        </div>

        <div class="controls">
            <h2 id="sync-title">Sincronizar Hora</h2>
            
            <div class="sync-buttons-wrapper">
                <button onclick="syncOnline()" id="sync-online-button">SINCRONIZAR ONLINE</button>
                
                <button onclick="setInitialTime()" id="sync-button">Ajustar Manualmente e Iniciar</button>
            </div>
            
            <label id="initial-time-label" for="initial-time">Ajuste Manual: Defina a hora exata atual *do Servidor 1* (HH:MM 24h):</label>
            <input type="time" id="initial-time" value="13:00"> 

            <p id="speed-factor-info" style="font-size: 0.9em; color: #888; margin-bottom: 15px;">
                *A hora correrá 7.0 vezes mais rápido.
            </p>
            
            <div id="submenu-title" class="submenu-title">Recursos Adicionais</div>

            <div class="fast-links">
                <a href="https://mapgenie.io/tarkov" target="_blank" class="mapgenie-link">
                    <img src="https://cdn.mapgenie.io/images/mapgenie.png" alt="MapGenie">
                </a>
                <a href="https://www.eft-ammo.com" target="_blank">EFT-AMMO</a>
                <a href="https://escapefromtarkov.fandom.com/wiki/Quests" target="_blank">QUESTS</a>
                <a href="https://static.wikia.nocookie.net/escapefromtarkov_gamepedia/images/1/19/QuestItemRequirements.png/revision/latest?cb=20250730162205" target="_blank" onerror="this.onerror=null; this.href='https://i.imgur.com/tNYAT09.jpeg';">KAPPA</a>
            </div>
            
            <div class="submenu-container">
                <div class="submenu-list">
                    <a href="https://www.eft-ammo.com/ammo-graph" target="_blank">Ammo Graph</a>
                    <a href="https://www.eft-ammo.com/flea-market-prices" target="_blank">Flea Prices</a>
                    <a href="https://www.eft-ammo.com/headsets-table" target="_blank">Headset Table</a>
                    <a href="https://www.eft-ammo.com/maps" target="_blank">Maps</a>
                    <a href="https://www.eft-ammo.com/wiki" target="_blank">Wiki</a>
                    <a href="https://www.eft-ammo.com/traders-reset-timers" target="_blank">Traders</a>
                    <a href="https://tarkovtracker.ca/" target="_blank">Quest/Item Tracker</a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="footer">
    <span id="footer-text">Criado por:</span> 
    <a href="https://www.youtube.com/@pandoriunmc" target="_blank">Pandoriun</a> 
    Por: 
    <a href="https://gemini.google.com" target="_blank">GEMINI<span class="gemini-logo"></span></a>
</div>

<script>
    // --- CONSTANTES ATUALIZADAS ---
    const SPEED_FACTOR = 7; // Correto
    const ONE_HOUR_IN_MS = 60 * 60 * 1000;
    const THREE_HOURS_IN_MS = 3 * ONE_HOUR_IN_MS; // UTC+3 Offset (3 horas)
    const TWELVE_HOURS_IN_MS = 12 * ONE_HOUR_IN_MS;
    const ONE_DAY_IN_MS = 24 * ONE_HOUR_IN_MS; // 86,400,000 ms

    // Corrigido para ser o tempo REAL que leva para Tarkov avançar 24 horas (um dia de Tarkov)
    const ACCELERATED_DAY_IN_MS = ONE_DAY_IN_MS / SPEED_FACTOR; 

    // Horário de fim dos Cultistas (7:00 da manhã de Tarkov)
    const CULTIST_END_HOUR = 7; 
    const CULTIST_END_MS_OF_DAY = CULTIST_END_HOUR * ONE_HOUR_IN_MS;
    const CULTIST_START_HOUR = 22; // 22:00 de Tarkov
    const CULTIST_START_MS_OF_DAY = CULTIST_START_HOUR * ONE_HOUR_IN_MS;
    
    let startTime; // Real timestamp (Date.now()) quando o relógio começou
    let initialTarkovTime1Ms; // Milissegundos do dia de Tarkov (0 a 86,400,000) no momento do início

    let intervalId;
    let currentLanguage = 'pt';

    // --- OBJETOS DE TRADUÇÃO ATUALIZADOS ---
    const translations = {
        pt: {
            title: "TARKOV TIMER by Pandoriun",
            cultist_alert: "RISCO DE CULTISTAS",
            cultist_countdown_part1: "restantes - ",
            cultist_countdown_part2: " Servidor ",
            server1: "Servidor 1",
            server2: "Servidor 2 (+12h)",
            sync_title: "Sincronizar Hora",
            sync_online_button: "SINCRONIZAR ONLINE",
            sync_manual_button: "Ajustar Manualmente e Iniciar",
            initial_time_label: "Ajuste Manual: Defina a hora exata atual *do Servidor 1* (HH:MM 24h):",
            speed_info: "*A hora correrá 7.0 vezes mais rápido.",
            submenu_title: "Recursos Adicionais",
            footer_text: "Criado por:",
            status_names: { 
                'MADRUGADA': 'MADRUGADA', 'MANHÃ': 'MANHÃ', 'DIA': 'DIA', 
                'TARDE': 'TARDE', 'NOITE': 'NOITE' 
            },
            alert_prompt: "Por favor, insira a hora inicial (HH:MM)."
        },
        en: {
            title: "TARKOV TIMER by Pandoriun",
            cultist_alert: "CULTIST RISK",
            cultist_countdown_part1: " remaining - ",
            cultist_countdown_part2: " Server ",
            server1: "Server 1",
            server2: "Server 2 (+12h)",
            sync_title: "Synchronize Time",
            sync_online_button: "SYNC ONLINE",
            sync_manual_button: "Adjust Manually and Start",
            initial_time_label: "Manual Adjust: Set the exact current time *for Server 1* (HH:MM 24h):",
            speed_info: "*Time will run 7.0 times faster.",
            submenu_title: "Additional Resources",
            footer_text: "Created by:",
            status_names: { 
                'MADRUGADA': 'PREDAWN', 'MANHÃ': 'MORNING', 'DIA': 'DAY', 
                'TARDE': 'AFTERNOON', 'NOITE': 'NIGHT' 
            },
            alert_prompt: "Please enter the initial time (HH:MM)."
        }
    };
    // --- FIM DOS OBJETOS DE TRADUÇÃO ---


    // Mapeamento de CORES/ESTILOS (mantido)
    const STATUS_MAP = {
        "MADRUGADA_COR": ["#ADD8E6", "rgba(173, 216, 230, 0.8)", "rgba(10, 10, 30, 0.95)"], 
        "AMANHECER": 	 ["#FFD700", "rgba(255, 215, 0, 0.8)", "rgba(50, 40, 20, 0.95)"], 
        "MANHÃ_COR": 	 ["#ADFF2F", "rgba(173, 255, 47, 0.8)", "rgba(30, 50, 20, 0.95)"], 
        "DIA": 		     ["#FFD700", "rgba(255, 215, 0, 0.8)", "rgba(60, 60, 30, 0.95)"], 
        "TARDE_COR": 	 ["#FFA500", "rgba(255, 165, 0, 0.8)", "rgba(55, 35, 10, 0.95)"],
        "ENTARDECER": 	 ["#FF4500", "rgba(255, 69, 0, 0.8)", "rgba(40, 20, 10, 0.95)"], 
        "ANOITECER": 	 ["#9370DB", "rgba(147, 112, 219, 0.8)", "rgba(25, 15, 35, 0.95)"], 
        "NOITE_COR": 	 ["#ADD8E6", "rgba(173, 216, 230, 0.8)", "rgba(15, 15, 40, 0.95)"], 	
    };

    // Funções de Status e Cores (mantidas)
    function getInternalStatusName(hour24) { 
        if (hour24 >= 0 && hour24 < 6) return 'MADRUGADA';
        if (hour24 >= 6 && hour24 < 8) return 'MANHÃ'; 
        if (hour24 >= 8 && hour24 < 12) return 'DIA'; 
        if (hour24 >= 12 && hour24 < 18) return 'TARDE'; 
        if (hour24 >= 18 && hour24 < 24) return 'NOITE'; 
        return 'UNKNOWN';
    }

    function getColorCategory(hour24) { 
        if (hour24 >= 0 && hour24 < 4) return 'MADRUGADA_COR';
        if (hour24 >= 4 && hour24 < 6) return 'AMANHECER'; 
        if (hour24 >= 6 && hour24 < 8) return 'MANHÃ_COR'; 
        if (hour24 >= 8 && hour24 < 12) return 'DIA'; 
        if (hour24 >= 12 && hour24 < 17) return 'TARDE_COR'; 
        if (hour24 >= 17 && hour24 < 19) return 'ENTARDECER'; 
        if (hour24 >= 19 && hour24 < 21) return 'ANOITECER'; 
        if (hour24 >= 21 && hour24 < 24) return 'NOITE_COR'; 
        return 'UNKNOWN'; 
    }
    
    /**
     * NOVO CÁLCULO DE COUNTDOWN
     * @param {number} currentTarkovTimeMs O tempo de Tarkov em milissegundos (0 a ONE_DAY_IN_MS).
     * @param {string} serverName O nome do servidor ('1' ou '2').
     * @returns {{isActive: boolean, countdown: string, server: string}}
     */
    function calculateCountdown(currentTarkovTimeMs, serverName) {
        // Horas de Tarkov
        const h = Math.floor(currentTarkovTimeMs / ONE_HOUR_IN_MS);
        
        // Verifica se estamos no período dos cultistas (22:00 até 06:59:59)
        const isCultistTime = (h >= CULTIST_START_HOUR || h < CULTIST_END_HOUR); 
        
        if (!isCultistTime) {
            return { isActive: false };
        }

        let remainingMs;
        
        if (h >= CULTIST_START_HOUR) {
            // Se estiver entre 22:00 e 23:59:59 (fim no dia seguinte)
            const msToEndOfDay = ONE_DAY_IN_MS - currentTarkovTimeMs;
            const msFromStartOfDay = CULTIST_END_MS_OF_DAY;
            remainingMs = msToEndOfDay + msFromStartOfDay;

        } else {
            // Se estiver entre 00:00 e 06:59:59 (fim no mesmo dia)
            remainingMs = CULTIST_END_MS_OF_DAY - currentTarkovTimeMs;
        }

        if (remainingMs < 0) remainingMs = 0; // Prevenção de erros

        const totalSeconds = Math.floor(remainingMs / 1000);
        const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
        const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
        const seconds = String(totalSeconds % 60).padStart(2, '0');
        
        const countdownText = `${hours}:${minutes}:${seconds}`;

        return { 
            isActive: true, 
            countdown: countdownText,
            server: serverName
        };
    }

    function updateCultistAlert(timeInDayMs1, timeInDayMs2) {
        const T = translations[currentLanguage];
        const alertWrapper = document.getElementById('cultist-alert-wrapper');
        const countdownElement = document.getElementById('cultist-alert-countdown');
        document.getElementById('cultist-alert').textContent = T.cultist_alert;
        
        const check1 = calculateCountdown(timeInDayMs1, "1");
        const check2 = calculateCountdown(timeInDayMs2, "2");

        let activeCheck = null;

        // Prioriza o contador maior (o que está mais longe de acabar), para dar mais tempo ao jogador
        if (check1.isActive && check2.isActive) {
            // Compara os milissegundos restantes, o maior é o mais importante
            if (check1.countdown > check2.countdown) {
                 activeCheck = check1;
            } else {
                 activeCheck = check2;
            }
        } else if (check1.isActive) {
            activeCheck = check1;
        } else if (check2.isActive) {
            activeCheck = check2;
        }

        if (activeCheck && activeCheck.isActive) {
            const serverNameHighlighted = `<span class="server-highlight">${T.cultist_countdown_part2}${activeCheck.server}</span>`;
            countdownElement.innerHTML = `${activeCheck.countdown} ${T.cultist_countdown_part1}${serverNameHighlighted}`;
            alertWrapper.classList.add('active');
        } else {
            alertWrapper.classList.remove('active');
            countdownElement.textContent = '';
        }
    }


    // --- FUNÇÕES PRINCIPAIS ---

    function updateTarkovClock() {
        if (startTime === undefined || initialTarkovTime1Ms === undefined) return;

        const elapsedRealTime = Date.now() - startTime;
        
        // Aceleração do tempo real decorrido
        const elapsedTarkovTime = elapsedRealTime * SPEED_FACTOR;
        
        // CORREÇÃO DE LÓGICA: O módulo agora usa o tempo real que representa um dia de Tarkov
        // O tempo total de jogo (em milissegundos) é o tempo de início + o tempo acelerado decorrido.
        const totalTarkovTimeMs = initialTarkovTime1Ms + elapsedTarkovTime;
        
        // O módulo garante que o tempo se repita a cada 24 horas de Tarkov (86,400,000 ms)
        const timeInDayMs1 = totalTarkovTimeMs % ONE_DAY_IN_MS; 
        
        // --- CLOCK 1 (Principal) ---
        // Converte os milissegundos do dia em horas/min/seg
        const h1 = Math.floor(timeInDayMs1 / ONE_HOUR_IN_MS);
        const m1 = Math.floor((timeInDayMs1 % ONE_HOUR_IN_MS) / (60 * 1000));
        const s1 = Math.floor((timeInDayMs1 % (60 * 1000)) / 1000);

        document.getElementById('tarkov-clock-1').textContent = `${String(h1).padStart(2, '0')}:${String(m1).padStart(2, '0')}:${String(s1).padStart(2, '0')}`;
        updateVisuals('tarkov-clock-1', 'status-1', h1, timeInDayMs1, true); 
        
        // --- CLOCK 2 (+12 horas) ---
        const timeInDayMs2 = (timeInDayMs1 + TWELVE_HOURS_IN_MS) % ONE_DAY_IN_MS;
        
        const h2 = Math.floor(timeInDayMs2 / ONE_HOUR_IN_MS);
        const m2 = Math.floor((timeInDayMs2 % ONE_HOUR_IN_MS) / (60 * 1000));
        const s2 = Math.floor((timeInDayMs2 % (60 * 1000)) / 1000);
        
        document.getElementById('tarkov-clock-2').textContent = `${String(h2).padStart(2, '0')}:${String(m2).padStart(2, '0')}:${String(s2).padStart(2, '0')}`;
        updateVisuals('tarkov-clock-2', 'status-2', h2, timeInDayMs2, false); 
        
        // ALERTA DE CULTISTAS
        updateCultistAlert(timeInDayMs1, timeInDayMs2);
    }

    /**
     * Atualiza as cores e o estado visual da tela.
     * @param {string} clockElementId ID do elemento do relógio.
     * @param {string} statusElementId ID do elemento do status.
     * @param {number} hour24 Hora de Tarkov (0-23).
     * @param {number} timeInDayMs Tempo de Tarkov em milissegundos (0 a 86,400,000).
     * @param {boolean} isServer1 Se é o servidor principal (para cor de fundo e estrelas).
     */
    function updateVisuals(clockElementId, statusElementId, hour24, timeInDayMs, isServer1) {
        const T = translations[currentLanguage];
        
        const colorCategory = getColorCategory(hour24);
        const [clockColor, shadowColor, backgroundColor] = STATUS_MAP[colorCategory];
        
        const internalStatusName = getInternalStatusName(hour24);
        const displayStatus = T.status_names[internalStatusName] || internalStatusName; 
        
        const clockElement = document.getElementById(clockElementId);
        const statusElement = document.getElementById(statusElementId);
        
        clockElement.style.color = clockColor;
        clockElement.style.textShadow = `0 0 15px ${shadowColor}, 0 0 5px rgba(0, 0, 0, 0.9)`;
        
        statusElement.textContent = displayStatus;
        statusElement.style.color = clockColor; 
        statusElement.className = `status-category`; 

        
        if (isServer1) {
            document.querySelector('.container').style.backgroundColor = backgroundColor;

            // --- LÓGICA DE ESTRELAS (Baseada na hora de Tarkov) ---
            const h = hour24;
            const m = Math.floor((timeInDayMs % ONE_HOUR_IN_MS) / (60 * 1000));
            const totalMinutes = h * 60 + m; 

            let opacity = 0;
            const MAX_CANVAS_OPACITY = 0.8; 

            // Estrelas acendem de 19:00 até 06:00
            if (h >= 19 || h < 6) { 
                if (h >= 19) { 
                    // Transição (19:00 -> 24:00)
                    const minutesSince19 = totalMinutes - (19 * 60); 
                    opacity = minutesSince19 / (5 * 60); 
                } else { 
                    // Transição (00:00 -> 06:00)
                    const minutesFromMidnight = totalMinutes; 
                    opacity = 1 - (minutesFromMidnight / (6 * 60)); 
                }
            }
            
            const finalOpacity = Math.max(0, Math.min(MAX_CANVAS_OPACITY, opacity * MAX_CANVAS_OPACITY));

            canvas.style.opacity = finalOpacity.toFixed(3);
        }
    }

    function startClock() {
        if (intervalId) {
            clearInterval(intervalId);
        }
        intervalId = setInterval(updateTarkovClock, 100); 
        updateTarkovClock(); 
    }
    
    // --- NOVO: FUNÇÃO DE SINCRONIZAÇÃO ONLINE (Baseada no tempo real e UTC+3) ---
    function syncOnline() {
        // 1. Captura o timestamp real
        startTime = Date.now(); 
        
        // 2. Calcula o "tempo base de Tarkov" em milissegundos
        // Lógica de Tarkov: Tarkov Time = (Real Time * 7) + 3 horas (Offset)
        const realTimeSinceEpoch = startTime; // Milissegundos desde 1970/01/01 00:00:00 UTC
        
        // O tempo que o relógio de Tarkov teria percorrido se tivesse começado no Unix Epoch
        const acceleratedTimeSinceEpoch = realTimeSinceEpoch * SPEED_FACTOR;
        
        // Adiciona o offset de 3 horas (UTC+3)
        const tarkovTimeWithOffset = acceleratedTimeSinceEpoch + THREE_HOURS_IN_MS;

        // O milissegundo inicial do dia no Tarkov é o módulo por 24h (86,400,000 ms)
        initialTarkovTime1Ms = tarkovTimeWithOffset % ONE_DAY_IN_MS;
        
        startClock();
    }


    // --- Funções de Sincronização Manual ---
    function setInitialTime() {
        const timeInput = document.getElementById('initial-time').value;
        
        if (!timeInput) {
            alert(translations[currentLanguage].alert_prompt); 
            return;
        }

        const [hours, minutes] = timeInput.split(':').map(Number);
        
        // 1. Captura o timestamp real
        startTime = Date.now(); 

        // 2. Calcula o ponto de partida em milissegundos de Tarkov para o Servidor 1 (0 a 86,400,000)
        initialTarkovTime1Ms = (hours * ONE_HOUR_IN_MS) + (minutes * 60 * 1000);

        startClock();
    }


    // --- Funções de Tradução, Canvas e Inicialização (Mantidas) ---

    function setLanguage(lang) {
        currentLanguage = lang;
        const T = translations[lang];
        
        // Elementos estáticos
        document.getElementById('page-title').textContent = T.title;
        document.getElementById('main-label').textContent = T.title;
        document.getElementById('server-label-1').textContent = T.server1;
        document.getElementById('server-label-2').textContent = T.server2;
        document.getElementById('sync-title').textContent = T.sync_title;
        
        // NOVOS BOTÕES
        document.getElementById('sync-online-button').textContent = T.sync_online_button;
        document.getElementById('sync-button').textContent = T.sync_manual_button;
        
        document.getElementById('initial-time-label').textContent = T.initial_time_label;
        document.getElementById('speed-factor-info').textContent = T.speed_info;
        document.getElementById('submenu-title').textContent = T.submenu_title;
        document.getElementById('footer-text').textContent = T.footer_text;

        // Atualiza a exibição (para traduzir os status e alertas)
        if (startTime !== undefined) {
            updateTarkovClock();
        } else {
            updateInitialDisplay(); 
        }
    }

    let canvas, ctx;
    const stars = [];
    const NUM_STARS = 500; 
    const MAX_STAR_SIZE = 2; 
    const STAR_COLOR = 'rgba(255, 255, 255, '; 
    
    function generateStar() { return {x: Math.random() * canvas.width,y: Math.random() * canvas.height,radius: Math.random() * MAX_STAR_SIZE + 0.5,alpha: Math.random() * 0.5 + 0.5 }; }
    function drawStars() { 
        ctx.clearRect(0, 0, canvas.width, canvas.height); 
        for (let i = 0; i < stars.length; i++) {
            const star = stars[i];
            ctx.beginPath();
            ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2, false);
            ctx.fillStyle = STAR_COLOR + star.alpha + ')'; 
            ctx.fill();
        }
    }
    function initializeCanvasAndStars() { 
        canvas = document.getElementById('stars-canvas');
        ctx = canvas.getContext('2d');
        const container = document.querySelector('.container');
        const setCanvasSize = () => {
             canvas.width = container.offsetWidth;
             canvas.height = container.offsetHeight;
             drawStars(); 
        };
        setCanvasSize();
        for (let i = 0; i < NUM_STARS; i++) {
            stars.push(generateStar());
        }
        window.addEventListener('resize', setCanvasSize);
        drawStars();
    }


    function updateInitialDisplay() { 
        // Usa o tempo de inicialização manual para exibir antes da sincronização
        const initialValue = document.getElementById('initial-time').value;
        const [hours, minutes] = initialValue.split(':').map(Number);
        
        const h1 = hours;
        const m = minutes;
        
        // Tempo em milissegundos para a exibição inicial
        const initialTime1Ms = (h1 * ONE_HOUR_IN_MS) + (m * 60 * 1000);

        document.getElementById('tarkov-clock-1').textContent = `${String(h1).padStart(2, '0')}:${String(m).padStart(2, '0')}:00`;
        updateVisuals('tarkov-clock-1', 'status-1', h1, initialTime1Ms, true);
        
        const h2 = (h1 + 12) % 24;
        const initialTime2Ms = (initialTime1Ms + TWELVE_HOURS_IN_MS) % ONE_DAY_IN_MS;

        document.getElementById('tarkov-clock-2').textContent = `${String(h2).padStart(2, '0')}:${String(m).padStart(2, '0')}:00`;
        updateVisuals('tarkov-clock-2', 'status-2', h2, initialTime2Ms, false);
        
        document.getElementById('cultist-alert-wrapper').classList.remove('active');
    }

    function initializeClockDisplay() {
        initializeCanvasAndStars();
        
        const initialLang = document.getElementById('language-select').value;
        setLanguage(initialLang); 
        
        updateInitialDisplay();

        // Listener do Enter
        const timeInput = document.getElementById('initial-time');
        timeInput.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' || event.keyCode === 13) {
                event.preventDefault(); 
                setInitialTime();
            }
        });
        
        // NOVO: Sincronização automática ao carregar a página 
        syncOnline(); 
    }

    window.onload = initializeClockDisplay; 
</script>

</body>
</html>
